{{ define "websocket"}}
<!-- the message's input -->
<input id="input" type="text" />

<!-- when clicked then an iris websocket event will be sent to the server
at this example we registered the 'chat' -->
<button id="sendBtn" onclick="send()">Send</button>

<!-- the messages will be shown here -->
<pre id="output"></pre>
<!-- import the iris client-side library for browser -->

<script>
    var scheme=document.location.protocol=="https:"?"wss":"ws";
    var port=document.location.port?(":"+document.location.port):"";
    // see app.Get("/echo", ws.Handler()) on main.go
    var wsURL = scheme + "://" + document.location.hostname  + port + "/echo";

    // var input=document.getElementById("input");
    // var output=document.getElementById("output");

    // // Ws comes from the auto-served '/iris-ws.js'
    // var socket = new WebSocket(wsURL)
    // socket.onopen = (function(){
    //     output.innerHTML += "Status: Connected\n";
    //     input.value = "{{ .paras.File }}";
    //     send();
    // });

    // socket.onclose = (function(){
    //     appendMessage("<div><center><h3>Disconnected</h3></center></div>");
    // });

    // // read events from the server
    // socket.onmessage = (function(msg){
    //     addMessage("<div>" + msg.Body + "</div>");
    // });

    function send() {
        addMessage("<div style='color: red'> me: " + input.value + "</div>"); // write ourselves
        socket.send(input.value); // send chat event data to the websocket server
        input.value  = ""; // clear the input
    }

    function addMessage(msg) {
        output.insertAdjacentHTML('afterbegin', msg);
    }

    function handleError(reason) {
        console.log(reason);
        window.alert(reason);
    }

    function handleNamespaceConnectedConn(nsConn) {
        nsConn.emit("chat", "{{ .paras.File }}");

        const inputTxt = document.getElementById("input");
        const sendBtn = document.getElementById("sendBtn");

        sendBtn.disabled = false;
        sendBtn.onclick = function () {
            const input = inputTxt.values
            inputTxt.value = "";

            nsConn.emit("pkg", input);
            addMessage("Me: " + input);
        };
    }

    async function runExample() {
        try {
            const conn = await neffos.dial(wsURL, {
                default: { // "default" namespace.
                    _OnNamespaceConnected: function (nsConn, msg) {
                        addMessage("connected to namespace: " + msg.Namespace);
                        handleNamespaceConnectedConn(nsConn);
                    },
                    _OnNamespaceDisconnect: function (nsConn, msg) {
                        addMessage("disconnected from namespace: " + msg.Namespace);
                    },
                    {{ .paras.File }}: function (nsConn, msg) { // "pkg" event.
                        addMessage(msg.Body);
                    }
                }
            });

            // You can either wait to conenct or just conn.connect("connect")
            // and put the `handleNamespaceConnectedConn` inside `_OnNamespaceConnected` callback instead.
            // const nsConn = await conn.connect("default");
            // handleNamespaceConnectedConn(nsConn);
            // nsConn.emit(...); handleNamespaceConnectedConn(nsConn);
            conn.connect("default");

        } catch (err) {
            handleError(err);
        }
    }

    runExample();
</script>
{{end}}